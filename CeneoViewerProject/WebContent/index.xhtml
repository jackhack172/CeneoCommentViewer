<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<h:head>
	<title>Insert title here</title>
</h:head>
<h:body>
	<h:outputStylesheet library="css" name="style.css" target="head" />
	<p:growl id="msgs" showDetail="true" />

	<h1>Przeglądarka komentarzy</h1>
	<h:form id="form">
		<p:growl id="messages" showDetail="true" sticky="true" closable="true" />

		<p:accordionPanel id="accordionPanel" cache="true">
			<p:tab title="Ładowanie danych">
				<p:panel id="buttonPanel">
					<p:inputText value="#{productCommentsView.productId}" />
					<p:commandButton value="ETL"
						update="buttonPanel, productDataTable, hiddenCommentsDataTable, form:messages"
						icon="ui-icon-check" actionListener="#{productCommentsView.etl}"
						onclick="PF('pbAjax').start();" />
					<p:commandButton value="E" update="transformButton, form:messages"
						icon="ui-icon-check" ajax="true"
						actionListener="#{productCommentsView.extract}"
						onclick="PF('pbAjax').start();" />
					<p:commandButton id="transformButton" value="T"
						update="buttonPanel, form:messages" icon="ui-icon-check"
						ajax="true" disabled="#{productCommentsView.isTDisabled()}"
						actionListener="#{productCommentsView.transform}" />
					<p:commandButton value="L"
						update="buttonPanel, productDataTable, hiddenCommentsDataTable, form:messages"
						icon="ui-icon-check" ajax="true"
						disabled="#{productCommentsView.isLDisabled()}"
						actionListener="#{productCommentsView.load}"
						onclick="PF('pbAjax').start();" />
					<p:commandButton value="Erase database"
						update="buttonPanel, productDataTable, commentsDataTable, hiddenCommentsDataTable, form:messages"
						icon="ui-icon-check" ajax="true"
						actionListener="#{productCommentsView.erase}"
						onclick="PF('pbAjax').start();" />
					<p:progressBar widgetVar="pbAjax" ajax="true"
						value="#{productCommentsView.ceneoDownloadService.progress}"
						labelTemplate="{value}%" styleClass="animated" global="false">
						<p:ajax event="complete"
							listener="#{productCommentsView.onComplete}"
							oncomplete="PF('pbAjax').cancel()" />
					</p:progressBar>
				</p:panel>
				<br />
			</p:tab>
			<p:tab title="Podgląd">
				<p:dataTable id="productDataTable" var="product"
					value="#{productCommentsView.previewProducts}"
					selectionMode="single" paginator="true" paginatorPosition="bottom"
					rows="10" selection="#{productCommentsView.selectedPreviewProduct}"
					rowKey="#{product.id}" ajax="true">
					<f:facet name="header">
			            Produkt
			        </f:facet>
					<p:ajax event="rowSelect"
						listener="#{productCommentsView.onRowSelect}"
						update="form:messages, :form:accordionPanel:commentsDataTable, :form:accordionPanel:hiddenCommentsDataTable," />
					<p:ajax event="rowUnselect"
						listener="#{productCommentsView.onRowUnselect}"
						update="form:messages, :form:accordionPanel:commentsDataTable, :form:accordionPanel:hiddenCommentsDataTable" />
					<p:column headerText="Id">
						<h:outputText value="#{product.id}" />
					</p:column>
					<p:column headerText="Model">
						<h:outputText value="#{product.model}" />
					</p:column>
					<p:column headerText="Marka">
						<h:outputText value="#{product.brand}" />
					</p:column>
					<p:column headerText="Typ">
						<h:outputText value="#{product.type}" />
					</p:column>
					<p:column headerText="Dodatkowe informacje">
						<h:outputText value="#{product.additionalInfo}" />
					</p:column>
				</p:dataTable>

				<p:dataTable id="commentsDataTable" var="comment"
					value="#{productCommentsView.previewComments}"
					selectionMode="single" paginator="true" paginatorPosition="bottom"
					rows="10" selection="#{productCommentsView.selectedPreviewComment}"
					rowKey="#{comment.id}" ajax="true">
					<f:facet name="header">
			            Komentarze
			        </f:facet>
					<p:column headerText="Id">
						<h:outputText value="#{comment.id}" />
					</p:column>
					<p:column headerText="Autor">
						<h:outputText value="#{comment.author}" />
					</p:column>
					<p:column headerText="Ocena">
						<h:outputText value="#{comment.stars}" />
					</p:column>
					<p:column headerText="Data">
						<h:outputText value="#{comment.date}" />
					</p:column>
					<p:column headerText="Pozytywne opinie">
						<h:outputText value="#{comment.numberOfPositiveOpinions}" />
					</p:column>
					<p:column headerText="Opinie">
						<h:outputText value="#{comment.numberOfOpinions}" />
					</p:column>
					<p:column headerText="Zalety"
						style="width: 46px; text-align: center">
						<p:commandButton update="form:accordionPanel:advantagesDiv"
							oncomplete="PF('commentAdvantages').show('#{component.clientId}')"
							icon="ui-icon-search" title="View">
							<f:setPropertyActionListener value="#{comment}"
								target="#{productCommentsView.selectedPreviewComment}" />
						</p:commandButton>
					</p:column>
					<p:column headerText="Wady" style="width: 46px; text-align: center">
						<p:commandButton update="form:accordionPanel:disadvantagesDiv"
							oncomplete="PF('commentDisadvantages').show('#{component.clientId}');"
							icon="ui-icon-search" title="View">
							<f:setPropertyActionListener value="#{comment}"
								target="#{productCommentsView.selectedPreviewComment}" />
						</p:commandButton>
					</p:column>
					<p:column headerText="Treść"
						style="width: 46px; text-align: center">
						<p:commandButton update="form:accordionPanel:summaryDiv"
							oncomplete="PF('commentSummary').show('#{component.clientId}')"
							icon="ui-icon-search" title="View">
							<f:setPropertyActionListener value="#{comment}"
								target="#{productCommentsView.selectedPreviewComment}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>

				<p:dataTable id="hiddenCommentsDataTable"
					styleClass="hiddenCommentsDataTable" var="comment"
					value="#{productCommentsView.previewComments}"
					selectionMode="single" paginator="true" paginatorPosition="bottom"
					rows="10" selection="#{productCommentsView.selectedPreviewComment}"
					rowKey="#{comment.id}" ajax="true">
					<f:facet name="header">
			            Komentarze
			        </f:facet>
					<p:column headerText="Id">
						<h:outputText value="#{comment.id}" />
					</p:column>
					<p:column headerText="Autor">
						<h:outputText value="#{comment.author}" />
					</p:column>
					<p:column headerText="Ocena">
						<h:outputText value="#{comment.stars}" />
					</p:column>
					<p:column headerText="Data">
						<h:outputText value="#{comment.date}" />
					</p:column>
					<p:column headerText="Zalety">
						<h:outputText value="#{comment.advantages}" />
					</p:column>
					<p:column headerText="Wady">
						<h:outputText value="#{comment.disadvantages}" />
					</p:column>
					<p:column headerText="Treść">
						<h:outputText value="#{comment.summary}" />
					</p:column>
					<p:column headerText="Pozytywne opinie">
						<h:outputText value="#{comment.numberOfPositiveOpinions}" />
					</p:column>
					<p:column headerText="Opinie">
						<h:outputText value="#{comment.numberOfOpinions}" />
					</p:column>
				</p:dataTable>

				<h:commandLink id="csv">
					<h:outputText value="Export to CSV" />
					<p:dataExporter type="csv"
						target="form:accordionPanel:hiddenCommentsDataTable"
						fileName="comments" />
				</h:commandLink>

				<p:overlayPanel widgetVar="commentAdvantages" showEffect="fade"
					hideEffect="fade" dismissable="false" showCloseIcon="true">
					<p:outputPanel id="advantagesDiv" style="text-align: justify;">
						<ul>
							<ui:repeat
								value="#{productCommentsView.selectedPreviewComment.advantages}"
								var="advantage">
								<li><h:outputText value="#{advantage}" /></li>
							</ui:repeat>
						</ul>
					</p:outputPanel>
				</p:overlayPanel>
				<p:overlayPanel widgetVar="commentDisadvantages" showEffect="fade"
					hideEffect="fade" dismissable="false" showCloseIcon="true">
					<p:outputPanel id="disadvantagesDiv" style="text-align: justify;">
						<ul>
							<ui:repeat
								value="#{productCommentsView.selectedPreviewComment.disadvantages}"
								var="disadvantage">
								<li><h:outputText value="#{disadvantage}" /></li>
							</ui:repeat>
						</ul>
					</p:outputPanel>
				</p:overlayPanel>
				<p:overlayPanel widgetVar="commentSummary" showEffect="fade"
					hideEffect="fade" dismissable="false" showCloseIcon="true"
					style="max-width: 50%; max-height: 60%; width: auto; height: auto;">
					<p:outputPanel id="summaryDiv" style="text-align: justify;">
						<h:outputText
							value="#{productCommentsView.selectedPreviewComment.summary}" />
					</p:outputPanel>
				</p:overlayPanel>
			</p:tab>
		</p:accordionPanel>
	</h:form>
</h:body>
</html>